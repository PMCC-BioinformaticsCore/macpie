<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assessing zero-inflation in your data • macpie</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing zero-inflation in your data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">macpie</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/macpie.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/quality_control.html">Quality control</a></li>
    <li><a class="dropdown-item" href="../articles/transcriptional_analyses.html">Transcriptional analyses</a></li>
    <li><a class="dropdown-item" href="../articles/high_throughput_screens.html">Compound screening</a></li>
    <li><a class="dropdown-item" href="../articles/cross_platform_compatibility.html">Cross-platform compatibility</a></li>
    <li><a class="dropdown-item" href="../articles/integration_across_modalities.html">Integration across modalities</a></li>
    <li><a class="dropdown-item" href="../articles/macpie_bioc.html">Working with Bioconductor classes</a></li>
    <li><a class="dropdown-item" href="../articles/assessing_zero_inflation.html">Assessing zero-inflation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/PMCC-BioinformaticsCore/macpie.git"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assessing zero-inflation in your data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PMCC-BioinformaticsCore/macpie/blob/HEAD/vignettes/assessing_zero_inflation.Rmd" class="external-link"><code>vignettes/assessing_zero_inflation.Rmd</code></a></small>
      <div class="d-none name"><code>assessing_zero_inflation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This is a quick demonstration of the
<code><a href="../reference/check_zeroinflation.html">check_zeroinflation()</a></code> function from our
<strong>macpie</strong> package. This function is a fast diagnostic tool
to help you assess whether your MACseq data exhibits zero-inflation
relative to a negative binomial (NB) model.</p>
<p>We use a lightweight convenience wrapper
<code><a href="../reference/subsample_genes.html">subsample_genes()</a></code> around
<strong><code><a href="https://rdrr.io/pkg/seqgendiff/man/select_counts.html" class="external-link">seqgendiff::select_counts()</a></code></strong> to create a
smaller object with a subset of genes for faster computation. This
function is also part of the <strong>macpie</strong> package.</p>
<p>Under the hood, <code><a href="../reference/check_zeroinflation.html">check_zeroinflation()</a></code> uses
<strong>edgeR</strong> to estimate gene-wise dispersions and compute
expected zero probabilities under a NB model. It then compares the
observed and expected zero-inflated indexes for each gene within each
group defined in the metadata.</p>
<p>This function:</p>
<ul>
<li><p>estimates gene-wise tagwise dispersions with edgeR (using all
selected groups),</p></li>
<li><p>builds NB-expected zero probabilities from TMMwsp-scaled means,
and</p></li>
<li><p>returns per-gene ZI (observed zeros minus NB-expected zeros) and
per-group summaries (e.g., % genes with ZI &gt; 0.05). ZI-cutoffs are
user-defined.</p></li>
</ul>
<p>The output is a list with two elements:</p>
<ul>
<li><p><code>summary_by_group</code>: A summary table showing the number
and percentage of genes that are zero-inflated for each group at
specified cutoffs.</p></li>
<li><p><code>gene_metrics_by_group</code>: A detailed table with
gene-wise metrics, including observed and expected zero numbers and
proportions, zero-inflation index (ZI), mean count, and dispersion
estimates for each gene in each group.</p></li>
</ul>
<p><strong>Note</strong>: <code><a href="../reference/check_zeroinflation.html">check_zeroinflation()</a></code> relies on
edgeR to estimate dispersion. The current implementation requires ≥2
groups in the design so that edgeR can stabilize gene-wise dispersions
across groups. If you only have a single group and still want a
design-aware baseline for expected zeros, fit a Gamma–Poisson/NB GLM and
compute the expected zero probabilities from its fitted means and
over-dispersion.</p>
<hr>
<p><br></p>
<p>Load data and preprocess before subsampling genes and checking for
zero-inflation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("macpie")  # or devtools::install_github("PMCC-BioinformaticsCore/macpie")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PMCC-BioinformaticsCore/macpie.git">macpie</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dcgerard/seqgendiff" class="external-link">seqgendiff</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define project variables</span></span>
<span><span class="va">project_name</span> <span class="op">&lt;-</span> <span class="st">"PMMSq033"</span></span>
<span><span class="va">project_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/PMMSq033_metadata.csv"</span>, package <span class="op">=</span> <span class="st">"macpie"</span><span class="op">)</span></span>
<span><span class="co"># Load metadata</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_metadata.html">read_metadata</a></span><span class="op">(</span><span class="va">project_metadata</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import raw data</span></span>
<span><span class="va">project_rawdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"/macpieData/PMMSq033/raw_matrix"</span><span class="op">)</span></span>
<span><span class="va">project_name</span> <span class="op">&lt;-</span> <span class="st">"PMMSq033"</span></span>
<span><span class="va">raw_counts</span> <span class="op">&lt;-</span> <span class="fu">Read10X</span><span class="op">(</span>data.dir <span class="op">=</span> <span class="va">project_rawdata</span><span class="op">)</span></span>
<span><span class="co"># Create tidySeurat object</span></span>
<span><span class="va">mac</span> <span class="op">&lt;-</span> <span class="fu">CreateSeuratObject</span><span class="op">(</span>counts <span class="op">=</span> <span class="va">raw_counts</span>,</span>
<span>                          project <span class="op">=</span> <span class="va">project_name</span>,</span>
<span>                          min.cells <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          min.features <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Feature names cannot have underscores ('_'), replacing with dashes</span></span>
<span><span class="co">#&gt; ('-')</span></span>
<span><span class="co"># Join with metadata</span></span>
<span><span class="va">mac</span> <span class="op">&lt;-</span> <span class="va">mac</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".cell"</span> <span class="op">=</span> <span class="st">"Barcode"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Add unique identifier</span></span>
<span><span class="va">mac</span> <span class="op">&lt;-</span> <span class="va">mac</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>combined_id <span class="op">=</span> <span class="fu">str_c</span><span class="op">(</span><span class="va">Compound_ID</span>, <span class="va">Concentration_1</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>combined_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">""</span>, <span class="va">.data</span><span class="op">$</span><span class="va">combined_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mac</span> <span class="op">&lt;-</span> <span class="va">mac</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Project</span> <span class="op">==</span> <span class="st">"Current"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="subsample-genes-without-filtering">Subsample genes without filtering<a class="anchor" aria-label="anchor" href="#subsample-genes-without-filtering"></a>
</h2>
<p>We first subsample genes without filtering to see the zero-inflation
results before filtering lowly expressed genes.</p>
<p>This is to randomly select a subset of 1000 genes for a quick check.
For a more comprehensive analysis, consider using a larger subset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subsample genes for faster computation</span></span>
<span><span class="va">sub_mac_unfiltered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_genes.html">subsample_genes</a></span><span class="op">(</span><span class="va">mac</span>, ngene <span class="op">=</span> <span class="fl">1000</span>, gselect <span class="op">=</span> <span class="st">"random"</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sub_mac_unfiltered</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<p>We now look at zero-inflation across high dose treatment groups and
DMSO control.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for zero-inflation</span></span>
<span><span class="va">high_doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_10$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sub_mac_unfiltered</span><span class="op">$</span><span class="va">combined_id</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#add DMSO_0</span></span>
<span><span class="va">high_doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">high_doses</span>, <span class="st">"DMSO_0"</span><span class="op">)</span></span>
<span><span class="va">zi_results_unfiltered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">sub_mac_unfiltered</span>, </span>
<span>                                  group_by <span class="op">=</span> <span class="st">"combined_id"</span>,</span>
<span>                                  samples <span class="op">=</span> <span class="va">high_doses</span>,</span>
<span>                                  batch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="view-gene-wise-metrics-for-each-group">View gene-wise metrics for each group<a class="anchor" aria-label="anchor" href="#view-gene-wise-metrics-for-each-group"></a>
</h4>
<p>For example, view the first few rows for DMSO_0 group:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zi_results_unfiltered</span><span class="op">$</span><span class="va">gene_metrics_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span><span class="op">==</span><span class="st">"DMSO_0"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    group            gene mean_count_group dispersion p0_obs</span></span>
<span><span class="co">#&gt; ENSG0000028644827 DMSO_0 ENSG00000286448            0.000   1.20e-01  1.000</span></span>
<span><span class="co">#&gt; VWA127            DMSO_0            VWA1            0.158   2.11e-02  0.842</span></span>
<span><span class="co">#&gt; ENSG0000027210627 DMSO_0 ENSG00000272106            0.526   3.71e-02  0.579</span></span>
<span><span class="co">#&gt; ENSG0000028758627 DMSO_0 ENSG00000287586            0.000   9.90e-03  1.000</span></span>
<span><span class="co">#&gt; FBXO4427          DMSO_0          FBXO44            5.474   9.77e-05  0.000</span></span>
<span><span class="co">#&gt; FHAD127           DMSO_0           FHAD1            0.158   9.90e-03  0.842</span></span>
<span><span class="co">#&gt;                   obs_zeros_num   p0_nb expected_zeros_num       ZI</span></span>
<span><span class="co">#&gt; ENSG0000028644827            19 1.00000             19.000  0.00000</span></span>
<span><span class="co">#&gt; VWA127                       16 0.85439             16.233 -0.01228</span></span>
<span><span class="co">#&gt; ENSG0000027210627            11 0.59545             11.314 -0.01650</span></span>
<span><span class="co">#&gt; ENSG0000028758627            19 1.00000             19.000  0.00000</span></span>
<span><span class="co">#&gt; FBXO4427                      0 0.00547              0.104 -0.00547</span></span>
<span><span class="co">#&gt; FHAD127                      16 0.85426             16.231 -0.01216</span></span></code></pre></div>
<p>And for Staurosporine_10 group:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zi_results_unfiltered</span><span class="op">$</span><span class="va">gene_metrics_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span><span class="op">==</span><span class="st">"Staurosporine_10"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                            group            gene mean_count_group dispersion</span></span>
<span><span class="co">#&gt; ENSG00000286448 Staurosporine_10 ENSG00000286448                0   1.20e-01</span></span>
<span><span class="co">#&gt; VWA1            Staurosporine_10            VWA1                0   2.11e-02</span></span>
<span><span class="co">#&gt; ENSG00000272106 Staurosporine_10 ENSG00000272106                0   3.71e-02</span></span>
<span><span class="co">#&gt; ENSG00000287586 Staurosporine_10 ENSG00000287586                0   9.90e-03</span></span>
<span><span class="co">#&gt; FBXO44          Staurosporine_10          FBXO44                1   9.77e-05</span></span>
<span><span class="co">#&gt; FHAD1           Staurosporine_10           FHAD1                0   9.90e-03</span></span>
<span><span class="co">#&gt;                 p0_obs obs_zeros_num p0_nb expected_zeros_num      ZI</span></span>
<span><span class="co">#&gt; ENSG00000286448  1.000             3 1.000               3.00  0.0000</span></span>
<span><span class="co">#&gt; VWA1             1.000             3 1.000               3.00  0.0000</span></span>
<span><span class="co">#&gt; ENSG00000272106  1.000             3 1.000               3.00  0.0000</span></span>
<span><span class="co">#&gt; ENSG00000287586  1.000             3 1.000               3.00  0.0000</span></span>
<span><span class="co">#&gt; FBXO44           0.333             1 0.414               1.24 -0.0811</span></span>
<span><span class="co">#&gt; FHAD1            1.000             3 1.000               3.00  0.0000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="view-summary-statistics-for-each-group">View summary statistics for each group<a class="anchor" aria-label="anchor" href="#view-summary-statistics-for-each-group"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zi_results_unfiltered</span><span class="op">$</span><span class="va">summary_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             group n_genes n_wells mean_p0_obs mean_p0_nb</span></span>
<span><span class="co">#&gt; 5-Azacytidine_10 5-Azacytidine_10    1000       3       0.659      0.671</span></span>
<span><span class="co">#&gt; Abemaciclib_10     Abemaciclib_10    1000       3       0.674      0.678</span></span>
<span><span class="co">#&gt; Adavosertib_10     Adavosertib_10    1000       3       0.673      0.683</span></span>
<span><span class="co">#&gt; ANASTROZOLE_10     ANASTROZOLE_10    1000       3       0.611      0.626</span></span>
<span><span class="co">#&gt; AZD-5991_10           AZD-5991_10    1000       3       0.627      0.641</span></span>
<span><span class="co">#&gt; CAMPTOTHECIN_10   CAMPTOTHECIN_10    1000       3       0.747      0.760</span></span>
<span><span class="co">#&gt; Capivasertib_10   Capivasertib_10    1000       3       0.602      0.616</span></span>
<span><span class="co">#&gt; Ceralasertib_10   Ceralasertib_10    1000       3       0.657      0.669</span></span>
<span><span class="co">#&gt; CHLORAMBUCIL_10   CHLORAMBUCIL_10    1000       3       0.610      0.622</span></span>
<span><span class="co">#&gt; CYTARABINE_10       CYTARABINE_10    1000       3       0.609      0.625</span></span>
<span><span class="co">#&gt;                   mean_ZI observed_zeros_num expected_zeros_num pct_ZI_gt_0.1</span></span>
<span><span class="co">#&gt; 5-Azacytidine_10 -0.01180               1978               2013         0.036</span></span>
<span><span class="co">#&gt; Abemaciclib_10   -0.00357               2023               2034         0.072</span></span>
<span><span class="co">#&gt; Adavosertib_10   -0.00970               2020               2049         0.043</span></span>
<span><span class="co">#&gt; ANASTROZOLE_10   -0.01495               1832               1877         0.029</span></span>
<span><span class="co">#&gt; AZD-5991_10      -0.01367               1882               1923         0.027</span></span>
<span><span class="co">#&gt; CAMPTOTHECIN_10  -0.01304               2241               2280         0.046</span></span>
<span><span class="co">#&gt; Capivasertib_10  -0.01376               1806               1847         0.039</span></span>
<span><span class="co">#&gt; Ceralasertib_10  -0.01241               1970               2007         0.038</span></span>
<span><span class="co">#&gt; CHLORAMBUCIL_10  -0.01273               1829               1867         0.036</span></span>
<span><span class="co">#&gt; CYTARABINE_10    -0.01566               1827               1874         0.029</span></span>
<span><span class="co">#&gt;                  pct_ZI_gt_0.2</span></span>
<span><span class="co">#&gt; 5-Azacytidine_10         0.015</span></span>
<span><span class="co">#&gt; Abemaciclib_10           0.034</span></span>
<span><span class="co">#&gt; Adavosertib_10           0.013</span></span>
<span><span class="co">#&gt; ANASTROZOLE_10           0.007</span></span>
<span><span class="co">#&gt; AZD-5991_10              0.007</span></span>
<span><span class="co">#&gt; CAMPTOTHECIN_10          0.015</span></span>
<span><span class="co">#&gt; Capivasertib_10          0.016</span></span>
<span><span class="co">#&gt; Ceralasertib_10          0.012</span></span>
<span><span class="co">#&gt; CHLORAMBUCIL_10          0.012</span></span>
<span><span class="co">#&gt; CYTARABINE_10            0.009</span></span></code></pre></div>
<p>From the summary table, we can see the summary statistics for each
group, including the number and percentage of genes that are
zero-inflated at the specified cutoffs.</p>
<p>Each of the columns in the summary table are defined as follows:</p>
<ul>
<li><p>group: The treatment group</p></li>
<li><p>n_genes: Total number of genes analyzed in the group</p></li>
<li><p>n_wells: Total number of wells/samples in the group</p></li>
<li><p>mean_p0_obs: mean observed zero proportion across genes in the
group</p></li>
<li><p>mean_p0_nb: mean expected zero proportion under the NB model
across genes in the group</p></li>
<li><p>mean_ZI: mean zero-inflation index (ZI = p0_obs - p0_nb for each
gene) across genes in the group</p></li>
<li><p>observed_zeros_num: Number of data points with observed zeros (it
shouldn’t be more than n_genes*n_wells for each group)</p></li>
<li><p>expected_zeros_num: Number of data points with expected zeros
under the NB model (same here, it shouldn’t be more than n_genes*n_wells
for each group)</p></li>
<li><p>pct_ZI_gt_0.1: Percentage of genes with ZI greater than
0.1</p></li>
<li><p>pct_ZI_gt_0.2: Percentage of genes with ZI greater than
0.2</p></li>
</ul>
<p>Visualisation of zero-inflation metrics for high dose treatment
groups and DMSO control.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">high_doses_zi_results_unfiltered</span> <span class="op">&lt;-</span> <span class="va">zi_results_unfiltered</span><span class="op">$</span><span class="va">summary_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_10$"</span>, <span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#concatenate with DMSO</span></span>
<span><span class="va">high_doses_zi_results_unfiltered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">high_doses_zi_results_unfiltered</span>,</span>
<span>                                <span class="va">zi_results_unfiltered</span><span class="op">$</span><span class="va">summary_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span><span class="op">==</span><span class="st">"DMSO_0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">long_zi_results_unfiltered</span> <span class="op">&lt;-</span> <span class="va">high_doses_zi_results_unfiltered</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">group</span>, <span class="va">mean_p0_obs</span>, <span class="va">mean_p0_nb</span>, <span class="va">mean_ZI</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean_p0_obs</span>, <span class="va">mean_p0_nb</span>, <span class="va">mean_ZI</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"metric"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rank groups by mean_p0_obs</span></span>
<span><span class="va">long_zi_results_unfiltered</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">long_zi_results_unfiltered</span><span class="op">$</span><span class="va">group</span>,</span>
<span>                                              levels <span class="op">=</span> <span class="va">high_doses_zi_results_unfiltered</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">high_doses_zi_results_unfiltered</span><span class="op">$</span><span class="va">mean_p0_obs</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#only show mean_p0_obs and mean_p0_nb</span></span>
<span><span class="va">long_zi_results_unfiltered_prop</span> <span class="op">&lt;-</span> <span class="va">long_zi_results_unfiltered</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_p0_obs"</span>, <span class="st">"mean_p0_nb"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">long_zi_results_unfiltered_prop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Zero-Inflation Metrics by Treatment Groups (10uM) and DMSO \nmacseq-unfiltered"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Groups"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"zero-inflation proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">macpie_colours</span><span class="op">$</span><span class="va">discrete</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show ZI separately</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">long_zi_results_unfiltered</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metric</span><span class="op">==</span><span class="st">"mean_ZI"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean Zero-Inflation Index (ZI) by Treatment Groups (10uM) and DMSO \nmacseq-unfiltered"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Groups"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Mean Zero-Inflation Index (ZI)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">macpie_colours</span><span class="op">$</span><span class="va">discrete</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="assessing_zero_inflation_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>Ranking of groups by mean observed zero proportion (mean_p0_obs)
shows that Staurosporine_10 has the highest observed zero proportion,
followed by Camptothecin_10, and paclitaxel_10. We can see
staurosporine_10 group has the highest mean ZI value and highest
proportion of zeros among all treatment groups, indicating significant
zero-inflation in this group. Other treatment groups show small or even
negative mean ZI values, suggesting no significant zero-inflation. As
staurosporine is a cell death control, which it is expected to see
zero-inflated data in this group.</p>
<p>DMSO control group with ~60% of zeros and small mean ZI value,
indicating no significant zero-inflation in the control group.</p>
</div>
</div>
<div class="section level2">
<h2 id="subsample-genes-after-filtering-lowly-expressed-genes">Subsample genes after filtering lowly expressed genes<a class="anchor" aria-label="anchor" href="#subsample-genes-after-filtering-lowly-expressed-genes"></a>
</h2>
<p>Filter genes with very low counts across all samples. This step is
important because genes with extremely low expression can lead to
unreliable estimates of dispersion and expected zero probabilities,
which can skew the zero-inflation assessment.</p>
<p>Here we filter genes that have at least 10 counts in at least 2
samples within each group defined by <code>combined_id</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter by read count per sample group</span></span>
<span><span class="va">mac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_genes_by_expression.html">filter_genes_by_expression</a></span><span class="op">(</span><span class="va">mac</span>, </span>
<span>                                  group_by <span class="op">=</span> <span class="st">"combined_id"</span>, </span>
<span>                                  min_counts <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                                  min_samples <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="subsample-genes-for-faster-computation">Subsample genes for faster computation<a class="anchor" aria-label="anchor" href="#subsample-genes-for-faster-computation"></a>
</h3>
<p>This is to randomly select a subset of 1000 genes for a quick check.
For a more comprehensive analysis, consider using a larger subset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subsample genes for faster computation</span></span>
<span><span class="va">sub_mac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_genes.html">subsample_genes</a></span><span class="op">(</span><span class="va">mac</span>, ngene <span class="op">=</span> <span class="fl">1000</span>, gselect <span class="op">=</span> <span class="st">"random"</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sub_mac</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for zero-inflation</span></span>
<span><span class="va">all_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sub_mac</span><span class="op">$</span><span class="va">combined_id</span><span class="op">)</span></span>
<span><span class="va">zi_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_zeroinflation.html">check_zeroinflation</a></span><span class="op">(</span><span class="va">sub_mac</span>, </span>
<span>                                  group_by <span class="op">=</span> <span class="st">"combined_id"</span>,</span>
<span>                                  samples <span class="op">=</span> <span class="va">all_conditions</span>,</span>
<span>                                  batch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="view-gene-wise-metrics-for-each-group-1">View gene-wise metrics for each group<a class="anchor" aria-label="anchor" href="#view-gene-wise-metrics-for-each-group-1"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zi_results</span><span class="op">$</span><span class="va">gene_metrics_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span><span class="op">==</span><span class="st">"Luminespib_10"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    group     gene mean_count_group dispersion p0_obs</span></span>
<span><span class="co">#&gt; MTND1P2364 Luminespib_10 MTND1P23             8.67   9.77e-05      0</span></span>
<span><span class="co">#&gt; MTATP6P164 Luminespib_10 MTATP6P1             5.67   1.64e-02      0</span></span>
<span><span class="co">#&gt; ISG1564    Luminespib_10    ISG15             7.00   9.77e-05      0</span></span>
<span><span class="co">#&gt; PUSL164    Luminespib_10    PUSL1             8.00   9.77e-05      0</span></span>
<span><span class="co">#&gt; DVL164     Luminespib_10     DVL1             5.33   9.77e-05      0</span></span>
<span><span class="co">#&gt; MRPL2064   Luminespib_10   MRPL20             8.67   4.96e-02      0</span></span>
<span><span class="co">#&gt;            obs_zeros_num    p0_nb expected_zeros_num        ZI</span></span>
<span><span class="co">#&gt; MTND1P2364             0 0.000301           0.000904 -0.000301</span></span>
<span><span class="co">#&gt; MTATP6P164             0 0.005591           0.016773 -0.005591</span></span>
<span><span class="co">#&gt; ISG1564                0 0.001346           0.004038 -0.001346</span></span>
<span><span class="co">#&gt; PUSL164                0 0.000547           0.001641 -0.000547</span></span>
<span><span class="co">#&gt; DVL164                 0 0.006143           0.018428 -0.006143</span></span>
<span><span class="co">#&gt; MRPL2064               0 0.001014           0.003043 -0.001014</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zi_results</span><span class="op">$</span><span class="va">summary_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               group n_genes n_wells mean_p0_obs mean_p0_nb</span></span>
<span><span class="co">#&gt; 5-Azacytidine_0.1 5-Azacytidine_0.1    1000       3    0.002667    0.01072</span></span>
<span><span class="co">#&gt; 5-Azacytidine_1     5-Azacytidine_1    1000       3    0.004000    0.00958</span></span>
<span><span class="co">#&gt; 5-Azacytidine_10   5-Azacytidine_10    1000       3    0.019667    0.02903</span></span>
<span><span class="co">#&gt; Abemaciclib_0.1     Abemaciclib_0.1    1000       3    0.001667    0.00614</span></span>
<span><span class="co">#&gt; Abemaciclib_1         Abemaciclib_1    1000       3    0.005333    0.01020</span></span>
<span><span class="co">#&gt; Abemaciclib_10       Abemaciclib_10    1000       3    0.037333    0.02891</span></span>
<span><span class="co">#&gt; Adavosertib_0.1     Adavosertib_0.1    1000       3    0.002333    0.00660</span></span>
<span><span class="co">#&gt; Adavosertib_1         Adavosertib_1    1000       3    0.004333    0.00784</span></span>
<span><span class="co">#&gt; Adavosertib_10       Adavosertib_10    1000       3    0.015333    0.02170</span></span>
<span><span class="co">#&gt; ANASTROZOLE_0.1     ANASTROZOLE_0.1    1000       3    0.000333    0.00875</span></span>
<span><span class="co">#&gt;                    mean_ZI observed_zeros_num expected_zeros_num pct_ZI_gt_0.1</span></span>
<span><span class="co">#&gt; 5-Azacytidine_0.1 -0.00805                  8               32.2         0.007</span></span>
<span><span class="co">#&gt; 5-Azacytidine_1   -0.00558                 12               28.7         0.007</span></span>
<span><span class="co">#&gt; 5-Azacytidine_10  -0.00936                 59               87.1         0.030</span></span>
<span><span class="co">#&gt; Abemaciclib_0.1   -0.00447                  5               18.4         0.005</span></span>
<span><span class="co">#&gt; Abemaciclib_1     -0.00487                 16               30.6         0.013</span></span>
<span><span class="co">#&gt; Abemaciclib_10     0.00842                112               86.7         0.098</span></span>
<span><span class="co">#&gt; Adavosertib_0.1   -0.00427                  7               19.8         0.007</span></span>
<span><span class="co">#&gt; Adavosertib_1     -0.00350                 13               23.5         0.012</span></span>
<span><span class="co">#&gt; Adavosertib_10    -0.00637                 46               65.1         0.037</span></span>
<span><span class="co">#&gt; ANASTROZOLE_0.1   -0.00842                  1               26.2         0.001</span></span>
<span><span class="co">#&gt;                   pct_ZI_gt_0.2</span></span>
<span><span class="co">#&gt; 5-Azacytidine_0.1         0.007</span></span>
<span><span class="co">#&gt; 5-Azacytidine_1           0.004</span></span>
<span><span class="co">#&gt; 5-Azacytidine_10          0.018</span></span>
<span><span class="co">#&gt; Abemaciclib_0.1           0.005</span></span>
<span><span class="co">#&gt; Abemaciclib_1             0.012</span></span>
<span><span class="co">#&gt; Abemaciclib_10            0.084</span></span>
<span><span class="co">#&gt; Adavosertib_0.1           0.006</span></span>
<span><span class="co">#&gt; Adavosertib_1             0.010</span></span>
<span><span class="co">#&gt; Adavosertib_10            0.025</span></span>
<span><span class="co">#&gt; ANASTROZOLE_0.1           0.001</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">high_doses_zi_results</span> <span class="op">&lt;-</span> <span class="va">zi_results</span><span class="op">$</span><span class="va">summary_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_10$"</span>, <span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#concatenate with DMSO</span></span>
<span><span class="va">high_doses_zi_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">high_doses_zi_results</span>,</span>
<span>                                <span class="va">zi_results</span><span class="op">$</span><span class="va">summary_by_group</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span><span class="op">==</span><span class="st">"DMSO_0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">long_zi_results</span> <span class="op">&lt;-</span> <span class="va">high_doses_zi_results</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">group</span>, <span class="va">mean_p0_obs</span>, <span class="va">mean_p0_nb</span>, <span class="va">mean_ZI</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean_p0_obs</span>, <span class="va">mean_p0_nb</span>, <span class="va">mean_ZI</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"metric"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rank groups by mean_p0_obs</span></span>
<span><span class="va">long_zi_results</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">long_zi_results</span><span class="op">$</span><span class="va">group</span>,</span>
<span>                                              levels <span class="op">=</span> <span class="va">high_doses_zi_results</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">high_doses_zi_results</span><span class="op">$</span><span class="va">mean_p0_obs</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#only show mean_p0_obs and mean_p0_nb</span></span>
<span><span class="va">long_zi_results_prop</span> <span class="op">&lt;-</span> <span class="va">long_zi_results</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metric</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_p0_obs"</span>, <span class="st">"mean_p0_nb"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">long_zi_results_prop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Zero-Inflation Metrics by Treatment Groups (10uM) and DMSO \nmacseq-filtered"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Groups"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"zero-inflation proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">macpie_colours</span><span class="op">$</span><span class="va">discrete</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show ZI separately</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">long_zi_results</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">metric</span><span class="op">==</span><span class="st">"mean_ZI"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean Zero-Inflation Index (ZI) by Treatment Groups (10uM) and DMSO \nmacseq-filtered"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Groups"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Mean Zero-Inflation Index (ZI)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">macpie_colours</span><span class="op">$</span><span class="va">discrete</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="assessing_zero_inflation_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>After filtering lowly expressed genes, we observe proportions of both
expected and observed zeros decrease across all treatment groups
compared to the unfiltered data. These results suggest that lowly
expressed genes contribute significantly to the overall zero counts or
sparsity in the data.</p>
<p>DMSO control group has the lowest observed and expected zero
proportions among all groups, and staurosporine_10 has the highest
observed and expected zero proportions. These findings are expected as
these are vehicle and positive controls.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nenad Bartonicek, Xin Liu, Laura Twomey, Michelle Meier, Richard Lupat, Stuart Craig, David Yoannidis, Jason Li, Tim Semple, Kaylene J Simpson, Mark X Li, Susanne Ramm.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
